<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Testing upgradeable applications · ZeppelinOS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Testing upgradeable applications · ZeppelinOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="When working with ZeppelinOS, you can test your contracts as you usually do, or you can have ZeppelinOS automatically set up your entire application in your testing environment. This allows you to replicate the same set of contracts that manage your application for each test you run."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102575245-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg" alt="ZeppelinOS"/><h2 class="headerTitleWithLogo">ZeppelinOS</h2></a><a href="/versions.html"><h3>1.4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/1.4.0/start.html" target="_self">Quickstart</a></li><li class=""><a href="/docs/1.4.0/apis.html" target="_self">Reference</a></li><li class=""><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li class=""><a href="https://github.com/zeppelinos" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>GUIDES</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>OVERVIEW</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/start.html">ZeppelinOS</a></li></ul></div><div class="navGroup navGroupActive"><h3>GUIDES</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/setup.html">Installation and setup</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/building.html">Building an upgradeable app</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/using.html">Using the stdlib</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/developing.html">Developing stdlibs</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/1.4.0/testing.html">Testing</a></li></ul></div><div class="navGroup navGroupActive"><h3>DEMOS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/basil.html">Basil</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/crafty.html">Crafty</a></li></ul></div><div class="navGroup navGroupActive"><h3>ONBOARDING LEGACY CONTRACTS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/erc20_onboarding.html">ERC20 opt-in onboarding</a></li></ul></div><div class="navGroup navGroupActive"><h3>ZOS-LIB</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/libstart.html">zos-lib quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/low_level_contract.html">Low level upgradeable contract</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/low_level_app.html">Low level upgradable app</a></li></ul></div><div class="navGroup navGroupActive"><h3>FURTHER REFERENCE</h3><ul><li class="navListItem"><a class="navItem" href="/docs/1.4.0/stdlib.html">OpenZeppelin stdlib</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/advanced.html">Advanced topics</a></li><li class="navListItem"><a class="navItem" href="/docs/1.4.0/whitepaper.html">Whitepaper</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Testing upgradeable applications</h1></header><article><div><span><p>When working with ZeppelinOS, you can test your contracts as you usually do, or you can have ZeppelinOS automatically set up your entire application in your testing environment. This allows you to replicate the same set of contracts that manage your application for each test you run.</p>
<p>The <code>zos</code> package provides a <code>TestApp()</code> function to retrieve your application structure from the <code>zos.json</code> file and deploy everything to the current test network. All contracts you have registered via <code>zos add</code>, plus all the contracts provided by the stdlib you have linked, will be available. The returned <a href="https://github.com/zeppelinos/zos-lib/blob/master/src/app/App.js"><code>App</code></a> object provides convenient methods for creating upgradeable instances of your contracts, which you can use for testing.</p>
<blockquote>
<p><strong>Important:</strong> for <code>TestApp</code> to work correctly in your testing environment, you need to set the <code>NODE_ENV</code> environment variable to <code>test</code> when running your tests. For instance, if you are using truffle, run <code>NODE_ENV=test truffle test</code>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h2>
<p>Given a small application, with a <code>Sample</code> contract, linked to a stdlib that provides a <code>StandardToken</code> implementation:</p>
<pre><code class="hljs css json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyProject"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.1.0"</span>,
  <span class="hljs-attr">"contracts"</span>: {
    <span class="hljs-attr">"Sample"</span>: <span class="hljs-string">"Sample"</span>
  },
  <span class="hljs-attr">"stdlib"</span>: {
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"openzeppelin-zos"</span>,
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.9.0"</span>
  }
}
</code></pre>
<p>To set up the full application in a test file, first import <code>TestApp</code> from <code>zos</code>:</p>
<pre><code class="hljs css js"><span class="hljs-keyword">import</span> { TestApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'zos'</span>;
</code></pre>
<p>Then invoke it in the test suite setup, optionally including a set of options to be used when deploying the contracts (such as <code>from</code>, <code>gas</code>, and <code>gasPrice</code>):</p>
<pre><code class="hljs css js">beforeEach(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.app = <span class="hljs-keyword">await</span> TestApp({ <span class="hljs-attr">from</span>: owner })
});
</code></pre>
<p>In a test, you can generate an instance for your contracts via the <code>createProxy</code> function of the app:</p>
<pre><code class="hljs css js"><span class="hljs-keyword">const</span> Sample = artifacts.require(<span class="hljs-string">'Sample'</span>)
it(<span class="hljs-string">'should create a proxy'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.createProxy(Sample);
  <span class="hljs-comment">// Use proxy ...</span>
})
</code></pre>
<p>The full code for the sample test file is:</p>
<pre><code class="hljs css js"><span class="hljs-keyword">import</span> { TestApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'zos'</span>;

<span class="hljs-keyword">const</span> Sample = artifacts.require(<span class="hljs-string">'Sample'</span>)
<span class="hljs-keyword">const</span> StandardToken = artifacts.require(<span class="hljs-string">'StandardToken'</span>)

contract(<span class="hljs-string">'Sample'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">[_, owner]</span>) </span>{

  beforeEach(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.app = <span class="hljs-keyword">await</span> TestApp({ <span class="hljs-attr">from</span>: owner })
  });

  it(<span class="hljs-string">'should create a proxy'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.createProxy(Sample);
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> proxy.greet();
    result.should.eq(<span class="hljs-string">'A sample'</span>)
  })

  it(<span class="hljs-string">'should create a proxy for the stdlib'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.app.createProxy(StandardToken);
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> proxy.totalSupply();
    result.toNumber().should.eq(<span class="hljs-number">0</span>);
  })
});
</code></pre>
<p>Use this convenient tool to write tests for your code and storage migrations before executing them in production.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="developing.html">← Previous</a><a class="docs-next button" href="basil.html">Next →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="ZeppelinOS" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/start.html">Guides</a><a href="/docs/apis.html">Reference</a></div><div><h5>More</h5><a href="https://zeppelinos.org">Main Site</a><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">GitHub</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="ZeppelinOS" width="170" height="45"/></a><section class="copyright">Copyright © 2017-present ZeppelinOS Global</section><section class="report-bugs"><a href="https://github.com/zeppelinos/zos/issues/new?labels=kind:documentation">Report a bug on this site</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '8d0b5afbba49947d9efb5659d1b08df7',
                indexName: 'zeppelinos',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>